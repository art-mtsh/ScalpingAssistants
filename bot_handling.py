# telegram_bot.py
import logging
import time

import telebot
import os
import chat_ids


TELEGRAM_TOKEN = '7458821979:AAEzkL3X-U6BVKwoS1Vnh5bNqMZYizivTIw'
bot4 = telebot.TeleBot(TELEGRAM_TOKEN)
disclaimer = '<i>–¢–æ—Ä–≥—ñ–≤–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏ –º–∞—î –≤–∏—Å–æ–∫—ñ —Ä–∏–∑–∏–∫–∏ —Ç–∞ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –∑–Ω–∞—á–Ω–∏—Ö —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –≤—Ç—Ä–∞—Ç! –£—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –ª–µ–∂–∏—Ç—å –Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –±–æ—Ç–∞.</i>'

# File to store user chat IDs
chat_ids_file = "user_chat_ids.txt"

# Load existing chat IDs
existed_chat_ids = set(chat_ids.get_existed_chat_ids())

@bot4.message_handler(commands=['start'])
def send_welcome(message):
    chat_id = message.chat.id
    if chat_id not in existed_chat_ids:
        chat_ids.save_new_chat_id(chat_id)
    msg = (
f"""üá∫üá¶ –°–ª–∞–≤–∞ –£–∫—Ä–∞—ó–Ω—ñ!

–û—Ç–æ–∂ —Ç–∏ –ø—Ä–∏—î–¥–Ω–∞–≤—Å—è(-–ª–∞—Å—å) –¥–æ —Ä–æ–∑—Å–∏–ª–∫–∏.
–ü–æ—Ç–æ—á–Ω–∞ —Å–µ—Å—ñ—è –∞–Ω–∞–ª—ñ–∑—É –≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∞, —Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –æ—á—ñ–∫—É–π –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

–©–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—å —è–∫ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—î –±–æ—Ç - —Ç–∏—Ü—è–π /how_it_works.
–©–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—å —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å - —Ç–∏—Ü—è–π /how_to_use
–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ - –∑–≤'—è–∂–∏—Å—å –∑—ñ –º–Ω–æ—é.
–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä—É—Å—Å–∫–∏–π - –∂–º–∏ /switch_to_ru

{disclaimer}
""")

    bot4.send_message(chat_id, msg, parse_mode="HTML")

@bot4.message_handler(commands=['switch_to_ru'])
def send_welcome(message):
    chat_id = message.chat.id
    if chat_id not in existed_chat_ids:
        chat_ids.save_new_chat_id(chat_id)

    pic = open(f'funnyhaha.gif', 'rb')
    bot4.send_animation(chat_id, pic)

@bot4.message_handler(commands=['how_to_use'])
def send_welcome(message):
    chat_id = message.chat.id
    if chat_id not in existed_chat_ids:
        chat_ids.save_new_chat_id(chat_id)

    msg = f"""
–Ø–∫—â–æ —î –∑–∞–π–≤—ñ –∫–æ—à—Ç–∏ - –∫—Ä–∞—â–µ –≤—ñ–¥–ø—Ä–∞–≤ —ó—Ö –Ω–∞ –¥–æ–ø–æ–º–æ–≥—É –°–∏–ª –û–±–æ—Ä–æ–Ω–∏ –£–∫—Ä–∞—ó–Ω–∏ üá∫üá¶ 

–ó–∞–¥–æ–Ω–∞—Ç–∏–≤? –©–æ—Å—å –∑–∞–ª–∏—à–∏–ª–æ—Å—å? –ó–Ω–∞—á —Å–ª—É—Ö–∞–π:

1. –û—Ç—Ä–∏–º–∞–≤—à–∏ —Å–∏–≥–Ω–∞–ª, –ø–æ–≥–ª—è–Ω—å —É–≤–∞–∂–Ω–æ –Ω–∞ —Å–∫—Ä—ñ–Ω.
2. –Ø–∫—â–æ –Ω–∞ —Å–∫—Ä—ñ–Ω—ñ —Ç–∏ –±–∞—á–∏—à —á–µ—Ä–≤–æ–Ω—É –ø—É–Ω–∫—Ç–∏—Ä–Ω—É –ª—ñ–Ω—ñ—é - —Ü–µ –≤–µ–ª–∏–∫–∏–π —Å–∞–π–∑, –π–æ–≥–æ —Ä–æ–∑–º—ñ—Ä –≤–∫–∞–∑–∞–Ω–∏–π –≤ –æ–ø–∏—Å—ñ.
3. –¢–µ, —â–æ –±–æ—Ç –ø—Ä–∏—Å–ª–∞–≤ —Ç–æ–±—ñ –∫–∞—Ä—Ç–∏–Ω–∫—É - –ù–ï –∑–Ω–∞—á–∏—Ç—å, —â–æ —Ü–µ–π —Å–∞–π–∑ –¥–æ—Å—ñ —Ç–∞–º —Å—Ç–æ—ó—Ç—å.
4. –¢–µ, —â–æ –≤—ñ–¥–∫—Ä–∏–≤—à–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª, —Ç–∏ –±–∞—á–∏—à —Ü–µ–π –∑–Ω–∞—á–Ω–∏–π —Å–∞–π–∑ - –ù–ï –∑–Ω–∞—á–∏—Ç—å —â–æ –≤—ñ–Ω –º–æ–Ω–æ–ª—ñ—Ç–Ω–∏–π —ñ –Ω–µ –∑–Ω—ñ–º–µ—Ç—å—Å—è!
5. –©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å —ñ –≤–∞–≥—É —Å–∞–π–∑—É (–¥–ª—è —Ä–∏–Ω–∫—É) —Ç—Ä–µ–±–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ—Ä–º—ñ–Ω–∞–ª —ñ –ø–æ—Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ —â—ñ–ª—å–Ω—ñ—Å—Ç—é. 
6. –Ø–∫—â–æ –≤–æ–Ω–∞ —Å—Ç–æ—ó—Ç—å, –Ω–µ –∑–Ω—ñ–º–∞—î—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ —Ü—ñ–Ω–∞ –≤ –ø–∞—Ä—ñ —Ç—ñ–∫—ñ–≤ –≤—ñ–¥ –Ω–µ—ó –∞–±–æ –Ω–∞–≤—ñ—Ç—å –≤–¥–∞—Ä—è—î—Ç—å—Å—è –æ–± –Ω–µ—ó - —Ü–µ —Ç–≤—ñ–π —à–∞–Ω—Å.

–¢–æ—Ä–≥—É–≤–∞—Ç–∏ –≤—ñ–¥–±—ñ–π, –ø—Ä–æ–±—ñ–π, —Ö–∏–±–Ω–∏–π –ø—Ä–æ–±—ñ–π - –Ω–∞ —Ç–≤—ñ–π —Ä–æ–∑—Å—É–¥. –ó–≤–∞–∂–∞–π –Ω–∞ –∑–∞–≥–∞–ª—å–Ω—É –∫–æ–Ω'—é–Ω–∫—Ç—É—Ä—É —Ä–∏–Ω–∫—É –º1, –º5, –ù1, –Ω–∞ —Ç—Ä–µ–Ω–¥–∏ —ñ –ª—ñ–Ω—ñ—ó S/R.
–ù–µ –ª–æ–≤–∏ –Ω–æ–∂—ñ, –Ω–µ —Ç–æ—Ä–≥—É–π –ü–†–û–¢–ò —Ä–∏–Ω–∫—É.

–í–¥–∞–ª–æ–≥–æ –ø–æ–ª—é–≤–∞–Ω–Ω—è üíµ

{disclaimer}
"""
    pic = open(f'exam1.jpg', 'rb')
    bot4.send_photo(chat_id, pic, msg, parse_mode="HTML")

@bot4.message_handler(commands=['no_size'])
def send_welcome(message):
    chat_id = message.chat.id
    if chat_id not in existed_chat_ids:
        chat_ids.save_new_chat_id(chat_id)

    bot4.send_message(message.chat.id,
f"""
–Ø–∫—à–æ —á–µ—Ä–≤–æ–Ω–æ—ó –ª—ñ–Ω—ñ—ó –Ω–∞ —Å–∫—Ä—ñ–Ω—à–æ—Ç—ñ –Ω–µ–º–∞ - –∑–Ω–∞—á–∏—Ç—å –∑–Ω–∞–π–¥–µ–Ω–∏–π –≤–µ–ª–∏–∫–∏–π —Å–∞–π–∑ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∫—Ä–∏—Ç–∏—á–Ω–æ –±–ª–∏–∑—å–∫–æ –¥–æ —Ä–∞–º–∫–∏. –¶–µ –≥—Ä–∞—Ñ—ñ—á–Ω–∏–π –±–∞–≥, –ø—Ä–æ—Å—Ç–æ —Ç–∞–º –ª—ñ–Ω—ñ—è –Ω–µ –º–∞–ª—é—î—Ç—å—Å—è, —è —Ö–∑, –∫–æ–ª–∏—Å—å –ø–æ–ø—Ä–∞–≤–ª—é. –í —Ç–∞–∫–æ–º—É —Ä–∞–∑—ñ –¥–∏–≤–∏—Å—å –ø—Ä–æ—Å—Ç–æ –Ω–∞ —Ü—ñ–Ω—É –≤ –æ–ø–∏—Å—ñ.

{disclaimer}
""", parse_mode="HTML")

@bot4.message_handler(commands=['how_it_works'])
def send_welcome(message):
    chat_id = message.chat.id
    if chat_id not in existed_chat_ids:
        chat_ids.save_new_chat_id(chat_id)

    msg = f'''
–û—Ç–∂–µ, —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î...

–ë–æ—Ç –æ–ø—Ä–∞—Ü—å–æ–≤—É—î 200+ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤. 
–ê–Ω–∞–ª—ñ–∑—É—î —ñ SPOT —ñ FUTURES. 
–£–≤–µ—Å—å –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–≤–æ–¥–∏—Ç—å—Å—è –Ω–∞ m1.

–ß–∞—Å—Ç–∏–Ω–∞ 1. –ü–æ—à—É–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤:
1. –û—Ç—Ä–∏–º—É—î –ø–µ—Ä–µ–ª—ñ–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∑ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∞
<i>fapi binance com/fapi/v1/exchangeInfo</i>
2. –§—ñ–ª—å—Ç—Ä—É—î –∑–∞ —Ä–æ–∑–º—ñ—Ä–æ–º —Ç—ñ–∫–∞(%) —Ç–∞ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É ATR(%) –Ω–∞ –º1:
- –º–µ–Ω—à–∏–π —Ä–æ–∑–º—ñ—Ä —Ç—ñ–∫–∞ –¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –±—ñ–ª—å—à —Ç–æ—á–Ω–æ–≥–æ –º–∞–Ω–µ–≤—Ä—É–≤–∞–Ω–Ω—è –≤ —Å—Ç–∞–∫–∞–Ω—ñ
- –±—ñ–ª—å—à–∏–π —Ä–æ–∑–º—ñ—Ä —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ ATR(%) –Ω–∞ –º1 –¥–∞—î —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Å–∫—ñ–ª—å–∫–∏ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤ –ø—Ä–æ–ª–µ—Ç–∏—Ç—å —Ü—ñ–Ω–∞ –∑–∞ 1,2,3.. —Ö–≤ —Ç–≤–æ—î—ó –ø–æ–∑–∏—Ü—ñ—ó
3. –§–æ—Ä–º—É—î —Å–ø–∏—Å–æ–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤.
4. –ß–µ–∫–∞—î 20 —Å–µ–∫—É–Ω–¥.
5. –ü–æ –∫–æ–∂–Ω–æ–º—É —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞.

–ß–∞—Å—Ç–∏–Ω–∞ 2. –ü–æ—à—É–∫ –µ–∫—Å—Ç—Ä–µ–º—É–º—ñ–≤ —ñ –∑–Ω–∞—á–Ω–∏—Ö —Å–∞–π–∑—ñ–≤ –ù–ê –Ω–∏—Ö.
1. –©–û–•–í–ò–õ–ò–ù–ò –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –±–∞—Ä–∏ —ñ —Å—Ç–∞–∫–∞–Ω –ø–æ —Å–ø–æ—Ç—É —ñ —Ñ—é—á—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∑ –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤:
<i>fapi binance com/fapi/v1/depth?symbol=...</i>
<i>api binance com/api/v3/depth?symbol=...</i>
<i>fapi binance com/fapi/v1/klines?symbol=...</i>
<i>api binance com/api/v3/klines?symbol=...</i>
2. –ü–æ—à—É–∫ –µ–∫—Å—Ç—Ä–µ–º—É–º—ñ–≤ —ñ –∑–Ω–∞—á–Ω–∏—Ö —Å–∞–π–∑—ñ–≤ –Ω–∞ –Ω–∏—Ö.
3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–æ–≥–æ —Å–∞–π–∑—É.

–ß–∞—Å—Ç–∏–Ω–∞ 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–æ–≥–æ —Å–∞–π–∑—É –ù–ê–î —Ü—ñ–Ω–æ—é (–¥–ª—è ask):
‚úÖ –¶—ñ–Ω–∞ —Å–∞–π–∑—É –≤–∏—â–∞ –ø–æ—Ç–æ—á–Ω–æ—ó.
‚úÖ –°–∞–π–∑ –Ω–∞ –µ–∫—Å—Ç—Ä–µ–º—É–º—ñ –∑ –∫—ñ–º–Ω–∞—Ç–æ—é –∑–ª—ñ–≤–∞ –≤ 10-30 —Ö–≤–∏–ª–∏–Ω.
‚úÖ –°–∞–π–∑ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –Ω–∞ 200 ask—ñ–≤.
‚úÖ –°–∞–π–∑ –í–î–í–Ü–ß–Ü –±—ñ–ª—å—à–∏–π –∑–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø–æ —Ä–æ–∑–º—ñ—Ä—É (–≤–∏–¥—ñ–ª—è—î—Ç—å—Å—è –≤ —Å—Ç–∞–∫–∞–Ω—ñ).
‚úÖ –°–∞–π–∑ –±—ñ–ª—å—à–∏–π –∑–∞ —Å–µ—Ä–µ–¥–Ω—ñ–π –æ–±—î–º –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 100 —Ö–≤–∏–ª–∏–Ω (m1).
‚úÖ –°–∞–π–∑ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ 3—Ö ATR–∞—Ö –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó —Ü—ñ–Ω–∏.

–¥–ª—è —Å–∞–π–∑—ñ–≤ –ü–Ü–î —Ü—ñ–Ω–æ—é (–¥–ª—è bid) - —Ç–æ–π —Å–∞–º–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

–í–∞–∂–ª–∏–≤–æ!
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —ñ –¥–ª—è —Å–ø–æ—Ç–∞ —ñ –¥–ª—è —Ñ—é—á–µ—Ä—Å—ñ–≤.
- –í–ø–µ—Ä—à–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π –≤–µ–ª–∏–∫–∏–π —Å–∞–π–∑ - –Ω–µ –ø—É–±–ª—ñ–∫—É—î—Ç—å—Å—è. –¢—ñ–ª—å–∫–∏ —è–∫—â–æ —á–µ—Ä–µ–∑ —Ö–≤–∏–ª–∏–Ω—É –≤—ñ–Ω —ñ –¥–æ—Å—ñ –Ω–∞ —Ç–æ–º—É –∂ –º—ñ—Å—Ü—ñ - —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —Å–∫—Ä—ñ–Ω —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è —Å—é–¥–∏. –Ø–∫—â–æ –≤—ñ–Ω –ø—Ä–æ–¥–æ–≤–∂—É—î —Ç–∞–º —Å—Ç–æ—è—Ç–∏ - —Å–∫—Ä—ñ–Ω–∏ –Ω–∞–¥—Ö–æ–¥–∏—Ç–∏–º—É—Ç—å —â–æ—Ö–≤–∏–ª–∏–Ω–∏.

{disclaimer}
'''
    bot4.send_message(chat_id, msg, parse_mode="HTML")

@bot4.message_handler(func=lambda message: True)
def handle_message(message):
    bot4.send_message(message.chat.id, "–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —è –Ω–µ —Ä–æ–∑—É–º—ñ—é, —Å–æ—Ä—è–Ω ü§∑üèª‚Äç‚ôÇÔ∏è")
    chat_id = message.chat.id
    pic = open(f'sticker.webm', 'rb')
    bot4.send_sticker(chat_id, pic)

# Function to send a photo to all users
def send_photo_to_all_users(pic, msg):
    for chat_id in existed_chat_ids:
        try:
            bot4.send_photo(chat_id, pic, msg)
        except Exception as e:
            print(f"Failed to send photo to {chat_id}: {e}")

def start_bot():
    bot4.infinity_polling()

